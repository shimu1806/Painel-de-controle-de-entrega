{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de controle de Entrega</title>
    <link rel="stylesheet" href="{% static 'css/extends.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdn.datatables.net/v/dt/jq-3.7.0/dt-2.0.6/datatables.min.css" rel="stylesheet"> <!-- alterar -->
    <script>
        setTimeout(function() {
            location.reload(); // Recarrega a página
        }, 5000); // 5000 milissegundos = 5 segundos
    </script>
</head>
    <body>


        <article class="container-main">
            <!-- container fundo -->
            <section class="container-base">
                {% for status_counts in status_counts_list  %}
                <!-- for status in pedido_status -->

                <div class="container-mural" id="status-container">


                    <div id="boxes" class="box1">
                        <img src="../../static/src/image.png">
                    </div>
                    <div id="boxes" class="box2">
                        <h4>NÃO INICIADO</h4>
                        <p>0</p>
                        <input type="checkbox" id="checkbox2">
                    </div>
                    <div id="boxes" class="box3">
                        <h4>EM ANDAMENTO</h4>
                        <p>0</p>
                        <input type="checkbox" id="checkbox3">
                    </div>
                    <div id="boxes" class="box4">
                        <h4>FINALIZADO</h4>
                        <p>0</p>
                        <input type="checkbox" id="checkbox4">
                    </div>
                    <div id="boxes" class="box5">
                        <h4>PAUSA</h4>
                        <p>0</p>
                        <input type="checkbox" id="checkbox5">
                    </div>
                    <div id="boxes" class="box6">
                        <h4>DIVERGÊNCIA</h4>
                        <p>0</p>
                        <input type="checkbox" id="checkbox6">
                    </div>
                </div>
                <!-- endfor -->
                {% endfor %}
                <!-- container tabela -->

                
                <div class="table-responsive-sm">
                    <table class="table table-dark table-hover">
                        <thead class="table table-dark">
                            <tr>
                                <td>STATUS</td>
                                <td>FILIAL</td>
                                <td>ORDEM</td>
                                <td>PEDIDO</td>
                                <td>CLIENT</td>
                                <td>LOJA</td>
                                <td>NOME</td>
                                <td>DTEMIS</td>
                                <td>HREMIS</td>
                                <td>DTINIS</td>
                                <td>HRINIS</td>
                                <td>DTFIMS</td>
                                <td>HRFIMS</td>
                                <td>NOTA</td>
                                <td>SERIE</td>
                                <td>PROD</td>
                                <td>DESC</td>
                            </tr>

                        </thead>

                    <tbody class="table-group-divider">
                
                    {% for produto in data %}
                    <tr class="table table-dark table-borderless" id="pagination">
                        <td><span class="status-{{ produto.CB7_STATUS }}"></span></td>
                        <td>{{ produto.CB7_FILIAL }}</td>
                        <td>{{ produto.CB7_ORDSEP }}</td>
                        <td>{{ produto.CB7_PEDIDO }}</td>
                        <td>{{ produto.CB7_CLIENT }}</td>
                        <td>{{ produto.CB7_LOJA }}</td>
                        <td>{{ produto.A1_NOME }}</td>
                        <td>{{ produto.CB7_DTEMIS }}</td>
                        <td>{{ produto.CB7_HREMIS }}</td>
                        <td>{{ produto.CB7_DTINIS }}</td>
                        <td>{{ produto.CB7_HRINIS }}</td>
                        <td>{{ produto.CB7_DTFIMS }}</td>
                        <td>{{ produto.CB7_HRFIMS }}</td>
                        <td>{{ produto.CB7_NOTA }}</td>
                        <td>{{ produto.CB7_SERIE }}</td>
                        <td>{{ produto.CB8_PROD }}</td>
                        <td>{{ produto.B1_DESC }}</td>
                    </tr>
                    {% endfor %}

                    </tbody>

                    </table>
                </div>
                <div class="pagination">
                    <span class="step-links">
                        {% if data.has_previous %}
                            <a href="?page=1">&laquo; first</a>
                            <a href="?page={{ data.previous_page_number }}">previous</a>
                        {% endif %}
                
                        <span class="current">
                            Page {{ data.number }} of {{ data.paginator.num_pages }}.
                        </span>
                
                        {% if data.has_next %}
                            <a href="?page={{ data.next_page_number }}">next</a>
                            <a href="?page={{ data.paginator.num_pages }}">last &raquo;</a>
                        {% endif %}
                    </span>
                </div>
                
            </section>
        </article>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        function updateStatusCounts() {
        fetch('http://127.0.0.1:8000/update_status_counts/')
        .then(response => response.json())
        .then(data => {
            const statusContainer = document.getElementById('status-container');

            // Update the status counts in the HTML element
            statusContainer.querySelector('.box2 p').textContent = data['1'];
            statusContainer.querySelector('.box3 p').textContent = data['2'];
            statusContainer.querySelector('.box4 p').textContent = data['0'];
            statusContainer.querySelector('.box5 p').textContent = data['3'];
            statusContainer.querySelector('.box6 p').textContent = data['4'];
            })
        .catch(error => {
            console.error('Error fetching status counts:', error);
            });
        }

        // Call the function to update the status counts
        updateStatusCounts();
        setInterval(fetchStatusCounts, 5000);
    </script>
</body>
</html>